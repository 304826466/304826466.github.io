webpackJsonp([6],{"+QYE":function(t,e){},HPC3:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={name:"userMgt",data:function(){return{searchName:"",styleData:{tableHeight:0,searchHeight:0},clickData:{},maindata:[],menuForm:{formTitle:"",formShow:!1,menuName:"",menuUrl:""}}},watch:{"$store.state.bodySize.height":function(t,e){this.styleData.tableHeight=this.$api.getHeightFun(-90),document.querySelector("#borderTable").style.height=this.styleData.tableHeight+"px"}},mounted:function(){this.searchFun(),this.styleData.tableHeight=this.$api.getHeightFun(-90),document.querySelector("#borderTable").style.height=this.styleData.tableHeight+"px"},methods:{toright:function(t){var e=this;this.maindata.forEach(function(a){a.resPid===t.resId&&(a.isshow=!1,e.toright(a)),a.resId===t.resId&&(a.direction="right")})},tobottom:function(t){this.maindata.forEach(function(e){e.resPid===t.resId&&(e.isshow=!0),e.resId===t.resId&&(e.direction="bottom")})},clickTreeName:function(t){"right"===t.direction?this.tobottom(t):this.toright(t)},searchFun:function(){var t=this;this.$api.promise({method:"POST",url:"findResource",data:{}}).then(function(e){e.data.code>0?(e.data.data.forEach(function(t){t.resId=t.id,t.isshow=!1,t.direction="right",-1===t.resPid&&(t.isshow=!0)}),t.maindata=t.hasChildTree(t.sonsTree(e.data.data,-1))):t.$message.error(e.data.desc)}).catch(function(e){t.$message.error("接口异常："+e)})},sonsTree:function(t,e){var a=[];return function t(e,i,r){for(var s=0;s<e.length;s++){var n=e[s];n.resPid===i&&(n.lev=r,a.push(n),t(e,n.resId,r+1))}}(t,e,0),a},hasChildTree:function(t){return t.forEach(function(e,a){for(var i=0;i<t.length;i++)if(t[i].resPid===e.resId){e.hasChild=!0;break}}),t},getChildren:function(t){var e=[],a=this;return function t(i){a.maindata.forEach(function(a){a.resPid===i&&(e.push(a.resId),t(a.resId))})}(t),e},addMenu:function(t){this.menuForm={formTitle:"新增菜单",formShow:!0,menuName:"",menuUrl:""},this.clickData=t||{resId:-1}},editMenu:function(t){this.clickData=t,this.menuForm={formTitle:"编辑菜单",formShow:!0,menuName:t.resName,menuUrl:t.resUrl}},deleteMenu:function(t){var e=this,a=this.getChildren(t.resId);a.push(t.resId),this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$api.promise({method:"POST",url:"delResourceArr",data:a}).then(function(t){t.data.code>0?(a.forEach(function(t){for(var a=e.maindata.length-1;a>=0;a--)e.maindata[a].resId===t&&e.maindata.splice(a,1)}),e.$message.success("删除成功")):e.$message.error(t.data.desc)}).catch(function(t){e.$message.error("接口异常："+t)})}).catch(function(){e.$message.info("已取消删除")})},viewSaveFun:function(){var t=this;if("新增菜单"===this.menuForm.formTitle){var e={resPid:this.clickData.resId,resName:this.menuForm.menuName,resUrl:this.menuForm.menuUrl};if(""===e.resName)return this.$message.error("请输入菜单名称"),!1;this.$api.promise({method:"POST",url:"addResource",data:e}).then(function(e){e.data.code>0?(e.data.data.resId=e.data.data.id,e.data.data.direction="right",t.maindata.push(e.data.data),t.maindata=t.hasChildTree(t.sonsTree(t.maindata,-1)),t.tobottom(t.clickData),t.menuForm.formShow=!1):t.$message.error(e.data.desc)}).catch(function(e){t.$message.error("接口异常："+e)})}else if("编辑菜单"===this.menuForm.formTitle){var a={id:this.clickData.resId,resPid:this.clickData.resPid,resName:this.menuForm.menuName,resUrl:this.menuForm.menuUrl};this.$api.promise({method:"POST",url:"updateResource",data:a}).then(function(e){e.data.code>0?(t.maindata.forEach(function(t){t.resId===e.data.data.id&&(t.resName=e.data.data.resName,t.resUrl=e.data.data.resUrl)}),t.maindata=t.hasChildTree(t.sonsTree(t.maindata,-1)),t.menuForm.formShow=!1):t.$message.error(e.data.desc)}).catch(function(e){t.$message.error("接口异常："+e)})}}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"menuMgt",on:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.viewSaveFun(e)}}},[a("div",{staticClass:"panel"},[a("div",{staticClass:"panel-heading"},[a("span",{staticStyle:{height:"40px","line-height":"40px"}},[t._v("菜单信息列表")]),t._v(" "),a("el-button",{staticStyle:{float:"right",margin:"4px 6px"},attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:function(e){t.addMenu(!1)}}},[t._v("新增菜单")])],1),t._v(" "),a("div",{staticClass:"panel-body"},[a("div",{staticClass:"demo-table",staticStyle:{padding:"10px"}},[t._m(0),t._v(" "),a("div",{staticStyle:{height:"0px","overflow-x":"auto"},attrs:{id:"borderTable"}},[a("table",{staticClass:"dataTable",attrs:{id:"dataTableTree",cellspacing:"0",cellpadding:"0",border:"0",width:"100%"}},[t._m(1),t._v(" "),a("tbody",{attrs:{id:"tbodyView"}},t._l(t.maindata,function(e){return a("tr",{directives:[{name:"show",rawName:"v-show",value:e.isshow,expression:"list.isshow"}],key:e.resId,class:{parentTd:-1===e.resPid}},[a("td",{staticStyle:{"padding-left":"15px"}},[a("div",{staticClass:"treeName",class:"lev"+e.lev,staticStyle:{"text-align":"left",cursor:"pointer"},on:{click:function(a){t.clickTreeName(e)}}},[a("i",{class:[e.hasChild?"el-icon-caret-"+e.direction:"iClassName"]}),t._v("\n                      "+t._s(e.resName)+"\n                    ")])]),t._v(" "),a("td",[t._v(t._s(e.resUrl))]),t._v(" "),a("td",{attrs:{width:"300px"}},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:function(a){t.addMenu(e)}}},[t._v("新增下级")]),t._v(" "),a("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-edit"},on:{click:function(a){t.editMenu(e)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(a){t.deleteMenu(e)}}},[t._v("删除")])],1)])}))])])])])]),t._v(" "),a("el-dialog",{attrs:{title:t.menuForm.formTitle,visible:t.menuForm.formShow,width:"400px"},on:{"update:visible":function(e){t.$set(t.menuForm,"formShow",e)}}},[a("el-form",{attrs:{size:"small","label-width":"80px"}},[a("el-form-item",{attrs:{label:"菜单名称",prop:"username"}},[a("el-input",{staticStyle:{width:"215px"},attrs:{clearable:""},model:{value:t.menuForm.menuName,callback:function(e){t.$set(t.menuForm,"menuName",e)},expression:"menuForm.menuName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"路径"}},[a("el-input",{staticStyle:{width:"215px"},attrs:{clearable:""},model:{value:t.menuForm.menuUrl,callback:function(e){t.$set(t.menuForm,"menuUrl",e)},expression:"menuForm.menuUrl"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.viewSaveFun}},[t._v("确 定")]),t._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.menuForm.formShow=!1}}},[t._v("取 消")])],1)],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{position:"relative"}},[e("div",{staticStyle:{position:"absolute",left:"0px",top:"0px","background-color":"#fff",width:"100%","z-index":"2"}},[e("table",{staticClass:"dataTable",attrs:{cellspacing:"0",cellpadding:"0",border:"0",width:"100%"}},[e("thead",[e("tr",[e("td",{attrs:{width:"200"}},[this._v("菜单名称")]),this._v(" "),e("td",{attrs:{width:"300"}},[this._v("路径")]),this._v(" "),e("td",{attrs:{width:"300"}},[this._v("操作")])])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("td",{attrs:{width:"200"}},[this._v("菜单名称")]),this._v(" "),e("td",{attrs:{width:"300"}},[this._v("路径")]),this._v(" "),e("td",{attrs:{width:"300"}},[this._v("操作")])])])}]};var s=a("VU/8")(i,r,!1,function(t){a("+QYE")},null,null);e.default=s.exports}});