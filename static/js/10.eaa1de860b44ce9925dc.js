webpackJsonp([10],{TWTd:function(e,t){},il1X:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("NC6I"),r=a.n(s),i={name:"userMgt",data:function(){return{search:{fullname:"",userName:""},styleData:{tableHeight:0,searchHeight:0},loading:!1,alldata:[],maindata:[],searchName:"",tableShow:!0,pageData:{size:100,total:0,page:1},addUser:!1,userForm:{formTitle:"",formShow:!1,username:"",name:"",company:"",phone:"",email:"",gender:"",state:"",ruleType:""},roleList:[],companyList:[],resetPwd:!1,resetData:{},newPwd:"",isSearch:0,checkList:[]}},watch:{"$store.state.bodySize.height":function(e,t){this.styleData.searchHeight=document.querySelector(".searchView").offsetHeight,this.styleData.tableHeight=this.$api.getHeightFun(this.styleData.searchHeight),this.tableShow=!1,this.tableShow=!0},isSearch:function(e){2===e&&this.searchFun()}},mounted:function(){var e=this;this.styleData.searchHeight=document.querySelector(".searchView").offsetHeight,this.styleData.tableHeight=this.$api.getHeightFun(this.styleData.searchHeight),this.$api.promise({method:"POST",url:"findRole",data:{}}).then(function(t){t.data.code>0?(e.isSearch++,e.roleList=t.data.data):e.$message.error(t.data.desc)}).catch(function(t){e.$message.error("接口异常："+t)}),this.$api.promise({method:"POST",url:"findCompany",data:{}}).then(function(t){console.log(t),t.data.code>0?(e.isSearch++,e.companyList=t.data.data):e.$message.error(t.data.desc)}).catch(function(t){e.$message.error("接口异常："+t)})},computed:{fileterList:function(){return this.spliceFun(this.alldata,this.pageData.size,this.pageData.page-1)}},methods:{searchFun:function(){var e=this,t={userLoginName:this.search.loginname,userFullName:this.search.fullname};this.loading=!0,this.$api.promise({method:"POST",url:"findUser",data:t}).then(function(t){if(e.loading=!1,t.data.code>0){var a=t.data.data;a.forEach(function(t){t.roleIdList=t.roleStrs.split(","),t.roleNameList=[],t.status=t.userStatus>0?"启用":"禁用",e.companyList.forEach(function(e){t.userCompanyId===e.id&&(t.userCompanyName=e.companyName)}),e.roleList.forEach(function(e){t.roleIdList.forEach(function(a){e.id===parseInt(a)&&t.roleNameList.push(e.roleName)})}),t.roleNameList=t.roleNameList.join(",")}),e.alldata=a,e.maindata=e.spliceFun(e.alldata,e.pageData.size,e.pageData.page-1)}else e.$message.error(t.data.desc)}).catch(function(t){e.$message.error("接口异常："+t)})},spliceFun:function(e,t,a){return this.pageData.total=e.length,e.slice(t*a,t*a+t)},handleReset:function(e,t){this.resetData=t,this.resetPwd=!0},newPwdFun:function(){var e=this,t={id:this.resetData.id,passWord:r()(this.newPwd)};this.$api.promise({method:"POST",url:"resetPassWord",data:t}).then(function(t){t.data.code>0?(e.$message.success("操作成功!"),e.resetPwd=!1,e.newPwd=""):e.$message.error(t.data.desc)}).catch(function(t){e.$message.error("接口异常："+t)})},addView:function(){this.userForm={formTitle:"新增用户",formShow:!0,username:"",name:"",company:"",phone:"",email:"",gender:"男",state:"开启",ruleType:[]}},handleEdit:function(e,t){this.userForm={id:t.id,formTitle:"编辑用户",formShow:!0,username:t.userLoginName,name:t.userFullName,company:t.userCompanyId,phone:t.userTele,email:t.userEmail,gender:"男",state:"开启",ruleType:t.roleNameList.split(",")},t.userStatus<0&&(this.userForm.state="禁用"),0===t.userSex&&(this.userForm.gender="女")},handleDelete:function(e,t){var a=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$api.promise({method:"POST",url:"deleteUser",data:{id:t.id}}).then(function(t){t.data.code>0?(a.$message.success("删除成功!"),a.alldata.splice(e,1)):a.$message.error(t.data.desc)}).catch(function(e){a.$message.error("接口异常："+e)})}).catch(function(){a.$message.info("已取消删除")})},handleSelectionChange:function(e){this.checkList=e},changeStatus:function(e){var t=this,a={userStatus:Number(e),userId:[]};this.checkList.forEach(function(e){a.userId.push(e.id)}),a.userId.length?this.$api.promise({method:"POST",url:"updateUserStatus",data:a}).then(function(a){a.data.code>0?(t.$message.success("操作成功!"),t.alldata.forEach(function(a){t.checkList.forEach(function(t){a.id===t.id&&(a.userStatus=Number(e),a.status=a.userStatus>0?"启用":"禁用")})})):t.$message.error(a.data.desc)}).catch(function(e){t.$message.error("接口异常："+e)}):this.$message({message:"请选择用户",type:"warning"})},handleSizeChange:function(e){this.pageData.size=e,this.maindata=this.spliceFun(this.alldata,this.pageData.size,this.pageData.page-1)},handleCurrentChange:function(e){this.pageData.page=e,this.maindata=this.spliceFun(this.alldata,this.pageData.size,this.pageData.page-1)},submitForm:function(){var e=this,t={userStatus:this.userForm.state,userCompanyId:this.userForm.company,userLoginName:this.userForm.username,userFullName:this.userForm.name,userSex:this.userForm.gender,userTele:this.userForm.phone,userEmail:this.userForm.email,roleList:[]};if(this.userForm.id&&(t.id=this.userForm.id),this.roleList.forEach(function(a){e.userForm.ruleType.forEach(function(e){a.roleName===e&&t.roleList.push({id:a.id})})}),""===t.userLoginName)return this.$message.error("请填写用户名"),!1;if(""===t.userFullName)return this.$message.error("请填写用户姓名"),!1;if(""===t.userCompanyId)return this.$message.error("请选择所属公司"),!1;return""===t.userTele?(this.$message.error("请填写手机号"),!1):/(^1[3|4|5|7|8]\d{9}$)|(^09\d{8}$)/.test(t.userTele)?""===t.userEmail?(this.$message.error("请填写邮箱信息"),!1):t.userEmail.indexOf("@")<0?(this.$message.error("请填写正确的邮箱信息"),!1):""===t.userStatus?(this.$message.error("请选择用户状态"),!1):t.roleList.length<1?(this.$message.error("请勾选所属角色"),!1):(t.userStatus="开启"===this.userForm.state?1:-1,t.userSex="男"===this.userForm.gender?1:-1,void("新增用户"===this.userForm.formTitle?this.$api.promise({method:"POST",url:"addUser",data:t}).then(function(t){if(t.data.code>0){e.$message.success("操作成功"),t.data.data.roleIdList=t.data.data.roleStrs.split(","),t.data.data.roleNameList=[],t.data.data.status=t.data.data.userStatus>0?"启用":"禁用",t.data.data.modifyTime=t.data.data.createrTime;var a=JSON.parse(sessionStorage.getItem("LoginUser"));t.data.data.createrName=a.userFullName,t.data.data.modifyName=a.userFullName,e.companyList.forEach(function(e){t.data.data.userCompanyId===e.id&&(t.data.data.userCompanyName=e.companyName)}),e.roleList.forEach(function(e){t.data.data.roleIdList.forEach(function(a){e.id===parseInt(a)&&t.data.data.roleNameList.push(e.roleName)})}),t.data.data.roleNameList=t.data.data.roleNameList.join(","),e.alldata.push(t.data.data),e.userForm.formShow=!1}else e.$message.error(t.data.desc)}).catch(function(t){e.$message.error("接口异常："+t)}):"编辑用户"===this.userForm.formTitle&&this.$api.promise({method:"POST",url:"updateUser",data:t}).then(function(a){a.data.code>0?(e.alldata.forEach(function(s){if(s.id===t.id){s.userStatus=a.data.data.userStatus,s.userCompanyId=a.data.data.userCompanyId,s.userLoginName=a.data.data.userLoginName,s.userFullName=a.data.data.userFullName,s.userSex=a.data.data.userSex,s.userTele=a.data.data.userTele,s.userEmail=a.data.data.userEmail,s.roleList=a.data.data.roleList,s.roleStrs=a.data.data.roleStrs,s.modifyTime=a.data.data.modifyTime;var r=JSON.parse(sessionStorage.getItem("LoginUser"));s.modifyName=a.data.data.modifyName?a.data.data.modifyName:r.userFullName}s.roleIdList=a.data.data.roleStrs.split(","),s.roleNameList=[],e.companyList.forEach(function(e){s.userCompanyId===e.id&&(s.userCompanyName=e.companyName)}),e.roleList.forEach(function(e){s.roleIdList.forEach(function(t){e.id===parseInt(t)&&s.roleNameList.push(e.roleName)})}),s.roleNameList=s.roleNameList.join(",")}),e.$message.success("操作成功"),e.userForm.formShow=!1):e.$message.error(a.data.desc)}).catch(function(t){e.$message.error("接口异常："+t)}))):(this.$message.error("请填写正确手机号"),!1)}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"userMgt"},[a("div",{staticClass:"searchView"},[e._v("\n    用户名：\n    "),a("el-input",{staticStyle:{width:"140px","margin-right":"20px"},attrs:{size:"small",clearable:"",placeholder:"请输入用户名"},model:{value:e.search.loginname,callback:function(t){e.$set(e.search,"loginname",t)},expression:"search.loginname"}}),e._v("\n    用户姓名：\n    "),a("el-input",{staticStyle:{width:"140px","margin-right":"20px"},attrs:{size:"small",clearable:"",placeholder:"请输入用户姓名"},model:{value:e.search.fullname,callback:function(t){e.$set(e.search,"fullname",t)},expression:"search.fullname"}}),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-search",type:"primary"},on:{click:e.searchFun}},[e._v("查询")])],1),e._v(" "),a("div",{staticClass:"panel"},[e._m(0),e._v(" "),a("div",{staticClass:"panel-body"},[a("div",{staticClass:"demo-table",staticStyle:{padding:"10px"}},[e.tableShow?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{border:"",data:e.fileterList,stripe:"",height:e.styleData.tableHeight},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"70"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userLoginName",label:"用户名",width:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"userFullName",label:"姓名",width:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"roleNameList",label:"拥有角色",width:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"userCompanyName",label:"所属公司"}}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createrName",label:"创建人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"modifyName",label:"修改人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"modifyTime",label:"修改时间",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"el-icon-edit",attrs:{size:"mini",type:"success"},on:{click:function(a){e.handleReset(t.$index,t.row)}}},[e._v("重置密码")]),e._v(" "),a("el-button",{staticClass:"el-icon-edit",attrs:{size:"mini",type:"success"},on:{click:function(a){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{size:"mini",type:"danger"},on:{click:function(a){e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1):e._e()],1)])]),e._v(" "),a("el-pagination",{staticStyle:{float:"right","margin-top":"10px"},attrs:{background:"","current-page":1,"page-sizes":[100,200,300,400],"page-size":e.pageData.size,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),a("div",{staticStyle:{position:"absolute",bottom:"0",width:"100%",height:"47px",left:"0px","background-color":"#fff"}},[a("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:e.addView}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-error"},on:{click:function(t){e.changeStatus("-1")}}},[e._v("禁用")]),e._v(" "),a("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-success"},on:{click:function(t){e.changeStatus("1")}}},[e._v("启用")])],1),e._v(" "),a("el-dialog",{attrs:{title:e.userForm.formTitle,visible:e.userForm.formShow},on:{"update:visible":function(t){e.$set(e.userForm,"formShow",t)}}},[a("el-form",{staticClass:"addfrom",attrs:{size:"small","label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{clearable:"",disabled:!0},model:{value:e.userForm.username,callback:function(t){e.$set(e.userForm,"username",t)},expression:"userForm.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户姓名",prop:"name"}},[a("el-input",{attrs:{clearable:""},model:{value:e.userForm.name,callback:function(t){e.$set(e.userForm,"name",t)},expression:"userForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"所属公司"}},[a("el-select",{attrs:{placeholder:"请选择所属公司"},model:{value:e.userForm.company,callback:function(t){e.$set(e.userForm,"company",t)},expression:"userForm.company"}},e._l(e.companyList,function(e){return a("div",{key:e.id},[a("el-option",{attrs:{label:e.companyName,value:e.id}})],1)}))],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[a("el-input",{attrs:{type:"number",clearable:""},model:{value:e.userForm.phone,callback:function(t){e.$set(e.userForm,"phone",t)},expression:"userForm.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{type:"email",clearable:""},model:{value:e.userForm.email,callback:function(t){e.$set(e.userForm,"email",t)},expression:"userForm.email"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"性别"}},[a("el-radio-group",{staticStyle:{height:"32px",margin:"0px",padding:"0px"},attrs:{size:"mini"},model:{value:e.userForm.gender,callback:function(t){e.$set(e.userForm,"gender",t)},expression:"userForm.gender"}},[a("el-radio",{attrs:{border:"",label:"男"}}),e._v(" "),a("el-radio",{attrs:{border:"",label:"女"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-radio-group",{staticStyle:{height:"32px",margin:"0px",padding:"0px"},attrs:{size:"mini"},model:{value:e.userForm.state,callback:function(t){e.$set(e.userForm,"state",t)},expression:"userForm.state"}},[a("el-radio",{attrs:{border:"",label:"开启",name:"state"}}),e._v(" "),a("el-radio",{attrs:{border:"",label:"禁用",name:"state"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"所属角色"}},[a("el-checkbox-group",{model:{value:e.userForm.ruleType,callback:function(t){e.$set(e.userForm,"ruleType",t)},expression:"userForm.ruleType"}},e._l(e.roleList,function(e){return a("div",{key:e.id,staticStyle:{display:"inline-block","margin-right":"10px"}},[a("el-checkbox",{attrs:{label:e.roleName,border:""}})],1)}))],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.submitForm()}}},[e._v("确 定")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.userForm.formShow=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"重置密码",visible:e.resetPwd,width:"500px"},on:{"update:visible":function(t){e.resetPwd=t}}},[a("el-form",{attrs:{"status-icon":"",size:"small"}},[a("el-form-item",{attrs:{label:"新密码",prop:"newPwd"}},[a("el-input",{attrs:{type:"password",clearable:""},model:{value:e.newPwd,callback:function(t){e.newPwd=t},expression:"newPwd"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.newPwdFun()}}},[e._v("确 定")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.resetPwd=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"panel-heading"},[t("span",{staticStyle:{height:"40px","line-height":"40px"}},[this._v("用户信息列表")])])}]};var l=a("VU/8")(i,o,!1,function(e){a("TWTd")},null,null);t.default=l.exports}});